<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Example-Walkthrough • StructuralDecompose</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Example-Walkthrough">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">StructuralDecompose</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/Decomposition.html">Decomposition</a></li>
    <li><a class="dropdown-item" href="../articles/Example-Walkthrough.html">Example-Walkthrough</a></li>
    <li><a class="dropdown-item" href="../articles/package_intro.html">Introduction</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Example-Walkthrough</h1>
            
      

      <div class="d-none name"><code>Example-Walkthrough.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>In this example, we will go through the various features of
StructuralDecompose. We will trace it’s behavior with the popular ‘Nile
Dataset’ that tracks the annual flow of the Nile river. This dataset has
a single break-point in the series. We will test our algorithm against
other common trend fitting algorithms as well.</p>
</div>
<div class="section level2">
<h2 id="getting-started">Getting Started<a class="anchor" aria-label="anchor" href="#getting-started"></a>
</h2>
<p>StructuralDecompose primarily relies on ‘Strucchange’ and
‘changepoints’ for the detection of breakpoints. Other packages will be
added soon. Currently the smoothening algorithm defaults to loess, but
we will add further smoothening algorithms in the future.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressMessages</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/warning.html" class="external-link">suppressWarnings</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/rkillick/changepoint/" class="external-link">changepoint</a></span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressMessages</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/warning.html" class="external-link">suppressWarnings</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">strucchange</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="loading-the-data">Loading the Data<a class="anchor" aria-label="anchor" href="#loading-the-data"></a>
</h2>
<p>To read the data we can use the simple:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">StructuralDecompose</span><span class="fu">::</span><span class="va"><a href="../reference/Nile_dataset.html">Nile_dataset</a></span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span></span></code></pre></div>
<p>Let’s see the movement of the data over time</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/matplot.html" class="external-link">matplot</a></span><span class="op">(</span><span class="va">data</span>, type <span class="op">=</span> <span class="st">'l'</span>, xlab <span class="op">=</span> <span class="st">'Years'</span>, ylab <span class="op">=</span> <span class="st">'Annual Flow of the Nile (10^8 m^3'</span><span class="op">)</span></span></code></pre></div>
<p><img src="Example-Walkthrough_files/figure-html/Base%20data%20visualization-1.png" width="700"></p>
<p>There is a sudden level shift within the data, let’s see decompose
with simple stl and see how well the data movement is captured.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">StructuralDecompose</span><span class="fu">::</span><span class="va"><a href="../reference/Nile_dataset.html">Nile_dataset</a></span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span></span>
<span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/ts.html" class="external-link">ts</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">)</span>, frequency <span class="op">=</span> <span class="fl">12</span><span class="op">)</span></span>
<span></span>
<span><span class="va">decomposed</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/stl.html" class="external-link">stl</a></span><span class="op">(</span><span class="va">data</span>, s.window <span class="op">=</span> <span class="st">'periodic'</span><span class="op">)</span></span>
<span></span>
<span><span class="va">seasonal</span> <span class="op">&lt;-</span> <span class="va">decomposed</span><span class="op">$</span><span class="va">time.series</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">trend</span> <span class="op">&lt;-</span> <span class="va">decomposed</span><span class="op">$</span><span class="va">time.series</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span></span>
<span><span class="va">remainder</span> <span class="op">&lt;-</span> <span class="va">decomposed</span><span class="op">$</span><span class="va">time.series</span><span class="op">[</span>,<span class="fl">3</span><span class="op">]</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="decomposition">Decomposition<a class="anchor" aria-label="anchor" href="#decomposition"></a>
</h2>
<p>Let’s decompose the time series into parts and observe it’s
behavior</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">seasonal</span>, <span class="va">remainder</span>, <span class="va">trend</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">'l'</span>, main <span class="op">=</span> <span class="st">'Decomposed Series'</span><span class="op">)</span></span></code></pre></div>
<p><img src="Example-Walkthrough_files/figure-html/stl%20plotting%20all-1.png" width="700"></p>
<p>As we can see the trend over explains the time series and we do not
see the average movement of the series</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/matplot.html" class="external-link">matplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">trend</span>, <span class="va">data</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">'l'</span>, xlab <span class="op">=</span> <span class="st">'Years'</span>, ylab <span class="op">=</span> <span class="st">'Annual Flow of the Nile (10^8 m^3'</span>, main <span class="op">=</span> <span class="st">'Trend vs Base Data'</span><span class="op">)</span></span></code></pre></div>
<p><img src="Example-Walkthrough_files/figure-html/Start%20of%20the%20function-1.png" width="700"></p>
<p>Let’s now check simple smoothening with lowess</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Trend</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lowess.html" class="external-link">lowess</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">$</span><span class="va">y</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/matplot.html" class="external-link">matplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">Trend</span>, <span class="va">data</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">'l'</span>, xlab <span class="op">=</span> <span class="st">'Years'</span>, ylab <span class="op">=</span> <span class="st">'Annual Flow of the Nile (10^8 m^3'</span>, main <span class="op">=</span> <span class="st">'Smoothened Trend vs Base Data'</span><span class="op">)</span></span></code></pre></div>
<p><img src="Example-Walkthrough_files/figure-html/Simple%20smoothening-1.png" width="700"></p>
<p>As we can see, it does not do a great job of identifying that
significant level shift, it smoothens the entire series at once.</p>
<p>Let’s see it’s behavior with StructuralDecompose</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">Results</span> <span class="op">&lt;-</span> <span class="fu">StructuralDecompose</span><span class="fu">::</span><span class="fu"><a href="../reference/StructuralDecompose.html">StructuralDecompose</a></span><span class="op">(</span>Data <span class="op">=</span> <span class="va">data</span><span class="op">)</span></span>
<span>  </span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/matplot.html" class="external-link">matplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">Results</span><span class="op">$</span><span class="va">trend_line</span>, <span class="va">data</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">'l'</span>, xlab <span class="op">=</span> <span class="st">'Years'</span>, ylab <span class="op">=</span> <span class="st">'Annual Flow of the Nile (10^8 m^3'</span>, main <span class="op">=</span> <span class="st">'New Trend vs Base Data'</span><span class="op">)</span></span></code></pre></div>
<p><img src="Example-Walkthrough_files/figure-html/New%20smoothening%20with%20old%20data-1.png" width="700"></p>
<p>As we can see, the algorithm treats the series as two separate time
series, and smoothens each one. This delivers a superior
decomposition.</p>
<p>Let’s see the other components of seasonality and the remainder.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/matplot.html" class="external-link">matplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">Results</span><span class="op">$</span><span class="va">seasonality</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">data</span> <span class="op">-</span> <span class="va">Results</span><span class="op">$</span><span class="va">trend_line</span><span class="op">)</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">'l'</span>, xlab <span class="op">=</span> <span class="st">'Years'</span>, ylab <span class="op">=</span> <span class="st">'Annual Flow of the Nile 10^8 m^3'</span>,main <span class="op">=</span> <span class="st">'Seasonality vs Detrended Data'</span><span class="op">)</span></span></code></pre></div>
<p><img src="Example-Walkthrough_files/figure-html/Seasonality-1.png" width="700"></p>
<p>As we can see the behavior of seasonality is much better now, let’s
compare it with the older series</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/matplot.html" class="external-link">matplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">seasonal</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">data</span> <span class="op">-</span> <span class="va">trend</span><span class="op">)</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">'l'</span>, xlab <span class="op">=</span> <span class="st">'Years'</span>, ylab <span class="op">=</span> <span class="st">'Annual Flow of the Nile 10^8 m^3'</span>,main <span class="op">=</span> <span class="st">'Seasonality vs Detrended Data'</span><span class="op">)</span></span></code></pre></div>
<p><img src="Example-Walkthrough_files/figure-html/New%20smoothening%20with%20older%20data-1.png" width="700"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Allen Sunny.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
